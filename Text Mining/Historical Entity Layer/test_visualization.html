<!DOCTYPE html>
<html>
<head>
    <title>Network Visualization Test</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        #network { width: 100%; height: 400px; border: 1px solid #ddd; }
        .status { padding: 10px; margin: 10px 0; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Network Visualization Test</h1>
    
    <div class="test-section">
        <h3>Library Loading Test</h3>
        <div id="lib-status" class="status">Checking vis.js library...</div>
    </div>
    
    <div class="test-section">
        <h3>Simple Network Test</h3>
        <button onclick="createSimpleNetwork()">Create Simple Network</button>
        <div id="simple-status" class="status">Ready to test</div>
        <div id="network"></div>
    </div>
    
    <div class="test-section">
        <h3>Data Processing Test</h3>
        <button onclick="testDataProcessing()">Test Data Processing</button>
        <div id="data-status" class="status">Ready to test</div>
        <div id="data-result"></div>
    </div>

    <script>
        // Test sample data in same format as the main application
        const sampleData = [
            {
                "extraction_count": 2,
                "extractions": [
                    {
                        "subject_entity": {"name": "Alice", "entity_type": "PERSON"},
                        "relation": {"semantic_form": "KNOWS", "surface_form": "knows"},
                        "object_entity": {"name": "Bob", "entity_type": "PERSON"},
                        "evidence_text": "Alice knows Bob"
                    },
                    {
                        "subject_entity": {"name": "Bob", "entity_type": "PERSON"},
                        "relation": {"semantic_form": "WORKS_AT", "surface_form": "works at"},
                        "object_entity": {"name": "Company", "entity_type": "ORGANIZATION"},
                        "evidence_text": "Bob works at Company"
                    }
                ]
            }
        ];
        
        // Test vis.js library loading
        function checkLibrary() {
            const statusEl = document.getElementById('lib-status');
            if (typeof vis !== 'undefined') {
                statusEl.className = 'status success';
                statusEl.textContent = '✓ vis.js library loaded successfully';
                console.log('vis.js version:', vis.version || 'unknown');
            } else {
                statusEl.className = 'status error';
                statusEl.textContent = '✗ vis.js library failed to load';
            }
        }
        
        // Test simple network creation
        function createSimpleNetwork() {
            const statusEl = document.getElementById('simple-status');
            const container = document.getElementById('network');
            
            try {
                if (typeof vis === 'undefined') {
                    throw new Error('vis.js library not available');
                }
                
                // Clear container
                container.innerHTML = '';
                
                // Create simple network data
                const nodes = new vis.DataSet([
                    {id: 1, label: 'Alice', color: '#ff9999'},
                    {id: 2, label: 'Bob', color: '#99ff99'},
                    {id: 3, label: 'Company', color: '#9999ff'}
                ]);
                
                const edges = new vis.DataSet([
                    {from: 1, to: 2, label: 'KNOWS'},
                    {from: 2, to: 3, label: 'WORKS_AT'}
                ]);
                
                const data = { nodes, edges };
                const options = {
                    nodes: {
                        font: { size: 16 },
                        borderWidth: 2
                    },
                    edges: {
                        font: { size: 14 }
                    }
                };
                
                const network = new vis.Network(container, data, options);
                
                statusEl.className = 'status success';
                statusEl.textContent = '✓ Simple network created successfully';
                
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = '✗ Error: ' + error.message;
                console.error('Network creation error:', error);
            }
        }
        
        // Test data processing (same logic as FilterTracker)
        function testDataProcessing() {
            const statusEl = document.getElementById('data-status');
            const resultEl = document.getElementById('data-result');
            
            try {
                // Simulate the FilterTracker.getFilteredData() logic
                const allTriples = [];
                
                sampleData.forEach(turn => {
                    if (!turn.extractions || !Array.isArray(turn.extractions)) {
                        return;
                    }
                    
                    turn.extractions.forEach(extraction => {
                        if (!extraction.subject_entity || !extraction.object_entity || !extraction.relation) {
                            return;
                        }
                        allTriples.push(extraction);
                    });
                });
                
                statusEl.className = 'status success';
                statusEl.textContent = `✓ Data processing successful: ${allTriples.length} triples found`;
                
                resultEl.innerHTML = '<h4>Processed Triples:</h4><ul>' + 
                    allTriples.map(t => `<li>${t.subject_entity.name} → ${t.relation.semantic_form} → ${t.object_entity.name}</li>`).join('') + 
                    '</ul>';
                    
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = '✗ Error: ' + error.message;
                console.error('Data processing error:', error);
            }
        }
        
        // Run tests when page loads
        window.addEventListener('load', function() {
            setTimeout(checkLibrary, 100);
        });
    </script>
</body>
</html>